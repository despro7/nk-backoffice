# Інтеграція обладнання в NK Backoffice

Цей документ описує як інтегрувати стаціонарний сканер штрих-кодів та ваги у додаток NK Backoffice.

## Підтримуване обладнання

### Сканер штрих-кодів MC-200PT
- **Тип підключення**: USB (HID режим)
- **Підтримувані формати**: EAN-13, EAN-8, UPC-A, Code-128, Code-39, QR-Code
- **Режим роботи**: Емуляція клавіатури

### Ваги ВТА-60
- **Тип підключення**: USB-COM конвертер (CH340)
- **Протокол**: RS-232
- **Одиниці виміру**: кг
- **Точність**: до 1 грама

## Режими роботи

### 1. Режим симуляції
- **Призначення**: Тестування без реального обладнання
- **Переваги**: Швидке тестування, не потребує обладнання
- **Обмеження**: Дані генеруються випадково

### 2. Локальне підключення
- **Призначення**: Пряме підключення обладнання до комп'ютера
- **Переваги**: Низька затримка, пряме керування
- **Обмеження**: Обладнання має бути підключене до того ж комп'ютера

### 3. WebSocket підключення
- **Призначення**: Віддалене підключення через мережу
- **Переваги**: Можливість підключення з інших комп'ютерів, централізоване керування
- **Обмеження**: Залежність від мережі, додаткова затримка

## Налаштування обладнання

### Сторінка налаштувань
Перейдіть до **Налаштування** → **Обладнання** для конфігурації:

#### Налаштування ваг
- **COM-порт**: Вкажіть порт, на якому підключені ваги
- **Швидкість**: Бодрейт з'єднання (зазвичай 9600)
- **Біти даних**: 7 або 8 біт
- **Стоп-біти**: 1 або 2
- **Паритет**: none, even, odd

#### Налаштування сканера
- **Автоматичне підключення**: Автоматичне підключення при запуску
- **Таймаут**: Час очікування відповіді (мс)

#### Налаштування WebSocket
- **URL сервера**: Адреса WebSocket сервера
- **Автоматичне перепідключення**: Автоматичне відновлення з'єднання
- **Інтервал перепідключення**: Час між спробами (мс)
- **Heartbeat інтервал**: Інтервал перевірки з'єднання (мс)

#### Налаштування симуляції
- **Діапазон ваги**: Мінімальна та максимальна вага для генерації
- **Затримка сканування**: Час імітації процесу сканування (мс)

## Підключення обладнання

### Ваги ВТА-60

1. **Фізичне підключення**:
   - Підключіть ваги до комп'ютера через USB-COM конвертер
   - Переконайтеся, що драйвер CH340 встановлено

2. **Визначення COM-порту**:
   - Відкрийте **Диспетчер пристроїв**
   - Знайдіть розділ **Порти (COM і LPT)**
   - Запишіть номер COM-порту (наприклад, COM4)

3. **Налаштування в додатку**:
   - Встановіть правильний COM-порт
   - Перевірте з'єднання кнопкою **"Тестувати з'єднання"**

### Сканер MC-200PT

1. **Фізичне підключення**:
   - Підключіть сканер до USB-порту комп'ютера
   - Сканер автоматично визначиться як HID-пристрій

2. **Перевірка роботи**:
   - Протестуйте скануванням штрих-коду
   - При проблемах перезавантажте сканер

### WebSocket підключення

1. **Запуск сервера**:
   ```bash
   cd server
   node equipmentWebSocketServer.js
   ```

2. **Налаштування клієнта**:
   - Встановіть URL сервера (зазвичай `ws://localhost:8080/equipment`)
   - Налаштуйте параметри перепідключення

3. **Перевірка з'єднання**:
   - Використайте кнопку **"Тестувати з'єднання"**
   - Перевірте статус підключення

## Тестування обладнання

### Тестування з'єднання
Кнопка **"Тестувати з'єднання"** перевіряє:
- Доступність обладнання
- Правильність налаштувань
- Стабільність з'єднання

### Симуляція роботи
- **"Симулювати сканування"**: Генерує випадковий штрих-код
- **"Симулювати зважування"**: Генерує випадкову вагу

## Розв'язання проблем

### Ваги не підключаються
1. Перевірте фізичне підключення
2. Переконайтеся, що драйвер встановлено
3. Перевірте правильність COM-порту
4. Спробуйте інші налаштування бодрейту

### Сканер не працює
1. Перевірте USB-підключення
2. Перезавантажте сканер
3. Перевірте режим роботи сканера
4. Спробуйте інший USB-порт

### WebSocket з'єднання не встановлюється
1. Перевірте, чи запущений сервер
2. Перевірте правильність URL
3. Переконайтеся, що порт не заблоковано файрволом
4. Перевірте мережеве з'єднання

## Розробка та розширення

### Додавання нового обладнання
1. Створіть новий сервіс у папці `services/`
2. Реалізуйте інтерфейси `ScaleData` або `BarcodeData`
3. Додайте логіку до `EquipmentService`
4. Оновіть хук `useEquipment`

### Налаштування протоколу
Для ваг ВТА-60 може знадобитися налаштування протоколу в `ScaleService.ts`:
```typescript
private protocol: ScaleProtocol = {
  startByte: '\x02', // STX
  endByte: '\x03',   // ETX
  dataLength: 8,
  checksum: false
};
```

### WebSocket сервер
WebSocket сервер знаходиться в `server/equipmentWebSocketServer.js` і може бути розширений для:
- Підтримки додаткових команд
- Логування дій
- Аутентифікації клієнтів
- Керування кількома пристроями

## Безпека

### WebSocket з'єднання
- Використовуйте WSS (WebSocket Secure) для продакшену
- Налаштуйте аутентифікацію клієнтів
- Обмежте доступ до мережі

### Локальне підключення
- Переконайтеся, що комп'ютер захищений від зовнішніх загроз
- Регулярно оновлюйте драйвери обладнання

## Підтримка

При виникненні проблем:
1. Перевірте логи в консолі браузера
2. Перевірте логи сервера (якщо використовується WebSocket)
3. Перевірте налаштування обладнання
4. Зверніться до документації обладнання

## Приклади використання

### Інтеграція в компоненти
```typescript
import { useEquipment } from '../hooks/useEquipment';

const MyComponent = () => {
  const [state, actions] = useEquipment();
  
  // Отримання поточної ваги
  const handleGetWeight = async () => {
    try {
      const weight = await actions.getWeight();
      console.log('Current weight:', weight.weight, weight.unit);
    } catch (error) {
      console.error('Failed to get weight:', error);
    }
  };
  
  // Симуляція сканування
  const handleSimulateScan = () => {
    const barcode = actions.simulateScan();
    console.log('Scanned barcode:', barcode.code);
  };
  
  return (
    <div>
      <p>Status: {state.isConnected ? 'Connected' : 'Disconnected'}</p>
      <p>Mode: {state.isSimulationMode ? 'Simulation' : 'Real'}</p>
      <button onClick={handleGetWeight}>Get Weight</button>
      <button onClick={handleSimulateScan}>Simulate Scan</button>
    </div>
  );
};
```

### Налаштування конфігурації
```typescript
const config: EquipmentConfig = {
  connectionType: 'websocket',
  websocket: {
    url: 'ws://192.168.1.100:8080/equipment',
    autoReconnect: true,
    reconnectInterval: 5000,
    maxReconnectAttempts: 10,
    heartbeatInterval: 30000
  }
};

actions.updateConfig(config);
```
