# Інтеграція SalesDrive з внутрішнім складом

## Опис

Цей проект реалізує інтеграцію системи SalesDrive з внутрішнім складом для автоматичної завантаження замовлень з 18.08.2025 та їх локальної обробки.

## Функціональність

### 1. Структура замовлень

- **id** — унікальний ідентифікатор замовлення
- **orderNumber** — номер замовлення з SalesDrive
- **trackingNumber** — номер ТТН
- **quantity** — кількість порцій
- **status** — статус замовлення
- **items** — склад замовлення, масив об'єктів { productName, quantity }
- **customer** — інформація про клієнта (ім'я, телефон, адреса)
- **totalPrice** — загальна вартість замовлення
- **orderDate** — дата замовлення

### 2. Потік роботи

#### Первинна завантаження:
1. Запит до SalesDrive API з параметрами дати (з 18.08.2025)
2. Отримання всіх замовлень з детальною інформацією
3. Структуризація та форматування даних

#### Обробка на складі:
1. Кладовщик бачить всі замовлення з 18.08.2025
2. Фільтрація по статусу та пошук
3. Зміна статусу замовлення з синхронізацією в SalesDrive

## Встановлення та налаштування

### 1. Залежності

```bash
npm install
# або
pnpm install
```

### 2. Налаштування SalesDrive API

1. Створіть файл `.env` на основі `env.example`
2. Додайте ваші дані:
```env
SALESDRIVE_API_URL="https://your-salesdrive-api.com"
SALESDRIVE_API_KEY="your_api_key_here"
```

3. Переконайтеся, що API SalesDrive підтримує:
   - GET `/orders` з параметрами дати
   - PUT `/orders/{id}/status` для оновлення статусу
   - GET `/orders/{id}` для детальної інформації

### 3. Запуск

```bash
# Сервер
npm run dev:server

# Клієнт
npm run dev
```

## API Endpoints

### Замовлення

- `GET /api/orders` - отримання всіх замовлень з 18.08.2025
- `GET /api/orders?status=Підтверджено` - фільтрація по статусу
- `POST /api/orders/sync` - синхронізація з SalesDrive
- `GET /api/orders/:id` - отримання детальної інформації про замовлення
- `PUT /api/orders/:id/status` - оновлення статусу замовлення
- `GET /api/orders/stats/summary` - статистика по замовленнях
- `GET /api/orders/raw/all` - raw дані для відладки

## Компоненти

### OrdersTable
Основна таблиця замовлень з можливістю:
- Фільтрації по статусу
- Пошуку по номеру замовлення або ТТН
- Синхронізації з SalesDrive
- Зміни статусу замовлення

### OrderDetails
Детальний перегляд замовлення з:
- Основною інформацією
- Складом замовлення
- Інформацією про клієнта
- Можливістю зміни статусу

### OrdersStats
Статистика по замовленнях з 18.08.2025:
- Загальна кількість
- По статусах
- Метадані (дата отримання, діапазон дат)

## Синхронізація

### Автоматична синхронизація
- Кнопка "Синхронізувати з SalesDrive" в таблиці замовлень
- Отримує всі замовлення з 18.08.2025
- Структуризує та форматує дані

### Оновлення статусів
- При зміні статусу автоматично синхронізується з SalesDrive
- Логування всіх операцій
- Обробка помилок API

## Структуризація даних

### Форматування замовлень
Кожен заказ автоматично форматується з урахуванням різних варіантів полів:
- Підтримка різних назв полів (id/orderId, status/orderStatus)
- Нормалізація статусів
- Форматування складу замовлення
- Обробка інформації про клієнта

### Параметри запиту
- **startDate**: 2025-08-18 (фіксована дата початку)
- **endDate**: поточна дата
- **limit**: 1000 (максимальна кількість замовлень)
- **includeItems**: true (включати склад замовлення)
- **includeCustomer**: true (включати інформацію про клієнта)

## Логування та відладка

### Консольні логи
Сервер логує:
- Параметри запитів до SalesDrive
- Кількість отриманих замовлень
- Результати фільтрації
- Помилки з'єднання та API
- Оновлення статусів

### Raw дані
- Endpoint `/api/orders/raw/all` для отримання необроблених даних
- Повна структура відповіді SalesDrive
- Метадані запиту та відповіді

## Безпека

### Аутентифікація
- Bearer токен для SalesDrive API
- Перевірка наявності обов'язкових параметрів
- Валідація відповідей API

### Обробка помилок
- Детальне логування помилок
- Graceful fallback при проблемах з API
- Інформативні повідомлення для користувача

## Підтримка

### Відомі особливості
- Фіксована дата початку (18.08.2025)
- Ліміт 1000 замовлень за запит
- Автоматичне форматування різних структур даних

### Плани розвитку
- [ ] Webhook підтримка для автоматичної синхронізації
- [ ] Розширена статистика та звіти
- [ ] Експорт даних в Excel/CSV
- [ ] Історія змін статусів
- [ ] Сповіщення про нові замовлення
- [ ] Кешування даних для швидшого доступу

## Технічні деталі

### SalesDriveService
- `fetchOrdersFromDate()` - отримання замовлень з дати
- `formatOrder()` - форматування замовлення
- `updateSalesDriveOrderStatus()` - оновлення статусу
- `getOrderDetails()` - детальна інформація

### API маршрути
- RESTful endpoints
- JSON відповіді з метаданими
- Структуровані дані для фронтенду
- Raw дані для відладки
