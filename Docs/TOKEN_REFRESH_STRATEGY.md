# üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

## üéØ **–ü—Ä–æ–±–ª–µ–º–∞**

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å `setInterval` –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö:
- **setInterval –º–æ–∂–µ—Ç "–∑–∞—Å—ã–ø–∞—Ç—å"** –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- **–¢–∞–π–º–µ—Ä—ã –Ω–µ—Ç–æ—á–Ω—ã** –≤ —Ñ–æ–Ω–æ–≤—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- **JavaScript –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω** –±—Ä–∞—É–∑–µ—Ä–æ–º –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤

## üõ†Ô∏è **–†–µ—à–µ–Ω–∏–µ: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è**

### 1. **Page Visibility API**
```typescript
// –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('visibilitychange', handleVisibilityChange);

const handleVisibilityChange = () => {
  if (!document.hidden) {
    // –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ–π, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
    checkTokenAndUpdateIfNeeded();
  }
};
```

### 2. **Activity Detection**
```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
events.forEach(event => {
  document.addEventListener(event, handleUserActivity, { passive: true });
});
```

### 3. **–£–º–Ω—ã–π —Ç–∞–π–º–µ—Ä**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 14
setInterval(checkTokenExpiry, 5 * 60 * 1000);

// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
if (timeSinceLastUpdate > 14 * 60 * 1000) {
  updateTokenIfNeeded();
}
```

### 4. **Fallback —á–µ—Ä–µ–∑ API –∑–∞–ø—Ä–æ—Å—ã**
```typescript
// –ü—Ä–∏ –∫–∞–∂–¥–æ–º API –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
if (response.status === 401) {
  const refreshed = await refreshToken();
  if (refreshed) {
    // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
    return retryRequest();
  }
}
```

## üìä **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**

| –°—Ü–µ–Ω–∞—Ä–∏–π | –î–µ–π—Å—Ç–≤–∏–µ | –ß–∞—Å—Ç–æ—Ç–∞ |
|----------|----------|---------|
| **–ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞** | –¢–∞–π–º–µ—Ä + –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç |
| **–ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞** | –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ | –°—Ä–∞–∑—É –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ |
| **API –∑–∞–ø—Ä–æ—Å—ã** | –ü—Ä–æ–≤–µ—Ä–∫–∞ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ | –ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ |

## üîç **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**

### **–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–∫–µ–Ω—ã
2. –ó–∞–ø—É—Å–∫–∞–µ–º —É–º–Ω—ã–π —Ç–∞–π–º–µ—Ä (5 –º–∏–Ω—É—Ç)
3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π

### **–ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
2. –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏:**
1. –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ–π ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
2. –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞–ª–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–ü—Ä–∏ API –∑–∞–ø—Ä–æ—Å–∞—Ö:**
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–∫—É—â–∏–º —Ç–æ–∫–µ–Ω–æ–º
2. –ü—Ä–∏ 401 ‚Üí –ø—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
3. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Üí –ø–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å
4. –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ ‚Üí –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Å–∏—Å—Ç–µ–º—ã

## ‚ö° **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**

‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤  
‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏  
‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**: –£—á–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–∫–ª–∞–¥–∫–∏  
‚úÖ **Fallback**: –†–µ–∑–µ—Ä–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–∏ —Å–±–æ—è—Ö  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã  

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **–¢–µ—Å—Ç 1: –ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 15+ –º–∏–Ω—É—Ç
4. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è

### **–¢–µ—Å—Ç 2: –î–æ–ª–≥–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
1. –û—Å—Ç–∞–≤—å—Ç–µ –≤–∫–ª–∞–¥–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞ 1+ —á–∞—Å
2. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ª—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
3. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω

### **–¢–µ—Å—Ç 3: API –∑–∞–ø—Ä–æ—Å—ã**
1. –î–æ–∂–¥–∏—Ç–µ—Å—å –∏—Å—Ç–µ—á–µ–Ω–∏—è access —Ç–æ–∫–µ–Ω–∞
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ª—é–±–æ–π API –∑–∞–ø—Ä–æ—Å
3. –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**

### **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```typescript
const TOKEN_LIFETIME = 15 * 60 * 1000;        // 15 –º–∏–Ω—É—Ç
const REFRESH_THRESHOLD = 14 * 60 * 1000;     // 14 –º–∏–Ω—É—Ç
const CHECK_INTERVAL = 5 * 60 * 1000;         // 5 –º–∏–Ω—É—Ç
const INACTIVITY_THRESHOLD = 5 * 60 * 1000;   // 5 –º–∏–Ω—É—Ç
```

### **–°–æ–±—ã—Ç–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
```typescript
const ACTIVITY_EVENTS = [
  'mousedown', 'mousemove', 'keypress', 
  'scroll', 'touchstart', 'click'
];
```

## üöÄ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ:
- **–í –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö**: –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Ç–∞–π–º–µ—Ä—É
- **–í –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏
- **–ü—Ä–∏ API –∑–∞–ø—Ä–æ—Å–∞—Ö**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ —Å `setInterval` –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! üéâ
