#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ QZ Tray

echo "üîå –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ QZ Tray"
echo ""

QZ_HOST="localhost"
QZ_PORT=8182
QZ_URL="http://${QZ_HOST}:${QZ_PORT}"

echo "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: $QZ_URL"
echo ""

# –°–ø—Ä–æ–±–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --connect-timeout 5 "$QZ_URL" 2>/dev/null)

if [ "$HTTP_CODE" = "200" ] || [ "$HTTP_CODE" = "000" ]; then
    echo "‚úÖ QZ Tray –ø—Ä–∞—Ü—é—î!"
    echo ""
    echo "–°—Ç–∞—Ç—É—Å: $HTTP_CODE"
    
    # –°–ø—Ä–æ–±–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–µ—Ä—Å—ñ—é
    RESPONSE=$(curl -s "$QZ_URL" 2>/dev/null)
    if [ ! -z "$RESPONSE" ]; then
        echo "–í—ñ–¥–ø–æ–≤—ñ–¥—å: $RESPONSE"
    fi
    
    echo ""
    echo "üéâ –í—Å–µ –ø—Ä–∞—Ü—é—î! –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ QZ Tray"
else
    echo "‚ùå QZ Tray –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î"
    echo ""
    echo "–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:"
    echo "  1. QZ Tray –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏—Ö –º–∞—à–∏–Ω–∞—Ö"
    echo "  2. QZ Tray –ø—Ä–∞—Ü—é—î –Ω–∞ —ñ–Ω—à–æ–º—É –ø–æ—Ä—Ç—É"
    echo "  3. –§–∞—î—Ä–≤–æ–ª –±–ª–æ–∫—É—î –∑'—î–¥–Ω–∞–Ω–Ω—è"
    echo ""
    echo "–†—ñ—à–µ–Ω–Ω—è:"
    echo "  - –ó–∞–ø—É—Å—Ç—ñ—Ç—å QZ Tray –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π –º–∞—à–∏–Ω—ñ"
    echo "  - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –Ω–µ–º–∞—î —ñ–Ω—à–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –Ω–∞ –ø–æ—Ä—Ç—É 8182"
    echo "  - –°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ $QZ_URL –≤ –±—Ä–∞—É–∑–µ—Ä—ñ –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π –º–∞—à–∏–Ω—ñ"
    echo ""
    
    # –î–æ–¥–∞—Ç–∫–æ–≤–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
    echo "üîç –î–æ–¥–∞—Ç–∫–æ–≤–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:"
    echo ""
    
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ä—Ç—É
    echo "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ä—Ç—É $QZ_PORT..."
    if command -v nc &> /dev/null; then
        if nc -z "$QZ_HOST" "$QZ_PORT" 2>/dev/null; then
            echo "‚úì –ü–æ—Ä—Ç $QZ_PORT –≤—ñ–¥–∫—Ä–∏—Ç–∏–π"
        else
            echo "‚úó –ü–æ—Ä—Ç $QZ_PORT –∑–∞–∫—Ä–∏—Ç–∏–π –∞–±–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π"
        fi
    elif command -v netstat &> /dev/null; then
        if netstat -tln | grep -q ":$QZ_PORT "; then
            echo "‚úì –ü–æ—Ä—Ç $QZ_PORT —Å–ª—É—Ö–∞—î"
        else
            echo "‚úó –ü–æ—Ä—Ç $QZ_PORT –Ω–µ —Å–ª—É—Ö–∞—î"
        fi
    else
        echo "‚ö† –ù–µ–º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ä—Ç (nc –∞–±–æ netstat –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ)"
    fi
    
    exit 1
fi

